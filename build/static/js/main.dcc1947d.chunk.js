(this.webpackJsonpbishop_new_client=this.webpackJsonpbishop_new_client||[]).push([[0],{26:function(e,t,n){},27:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),o=n(19),i=n.n(o),s=(n(26),n(9)),a=n(3),j=(n(27),n(38),n(28),n(17)),h=n(21),l=n(11),u=n.n(l),b=n(14),d=n(20),x="http://bishop.horder.ru/api/",O=n(0),f=Object(r.createContext)();function p(e){var t=e.children,n=function(){var e=Object(r.useState)(T),t=Object(d.a)(e,2),n=t[0],c=t[1];Object(r.useEffect)((function(){setTimeout((function(){c(k)}),1500)}),[]);var o=function(e,t,n){localStorage.setItem("authToken",e),localStorage.setItem("authTokenExpires",t),localStorage.setItem("refreshToken",n)},i=function(){localStorage.removeItem("authToken"),localStorage.removeItem("authTokenExpires")},s=function(){i(),c(v)},a=function(e,t){return fetch(x+"/login",{method:"POST",headers:{"Content-Type":"application/json"},body:{email:e,password:t}}).then((function(e){return e.ok?e.json():s()})).then((function(e){o(e.token,e.tokenExpires,e.refreshToken)}))},j=function(e){return fetch(x+"/login",{method:"POST",headers:{"Content-Type":"application/json"},body:{refresh_token:e}}).then((function(e){if(e.ok)throw s(),new Error("Refresh token error");return e.json()})).then((function(e){var t=e.response;return o(t.token,t.tokenExpires,t.refreshToken),t.token}))},h=function(){var e=Object(b.a)(u.a.mark((function e(){var t,n,r,c,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("authToken"),n=localStorage.getItem("authTokenExpires"),r=localStorage.getItem("refreshToken"),!(t&&o&&r)){e.next=6;break}throw s(),new Error("Token does not exist");case 6:if(c=new Date((new Date).toUTCString()),o=new Date(new Date(n).toUTCString()),!(c<o)){e.next=12;break}return e.abrupt("return",t);case 12:return e.next=14,j(r);case 14:return e.abrupt("return",e.sent);case 15:case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{authStatus:n,login:a,logout:s,getToken:h}}();return Object(O.jsx)(f.Provider,{value:n,children:t})}function g(){return Object(r.useContext)(f)}var T="AUTH_PENDING",k="AUTH_AUTHORIZED",v="AUTH_NOT_AUTHORIZED";function m(e){return Object(O.jsx)("div",{style:{background:"#e7ebef",position:"fixed",top:0,left:0,width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(O.jsx)("span",{children:"loading..."})})}function w(e){var t=e.children,n=Object(h.a)(e,["children"]),r=g();return r.authStatus===T?Object(O.jsx)(m,{}):Object(O.jsx)(a.b,Object(j.a)(Object(j.a)({},n),{},{render:function(e){var n=e.location;return r.authStatus===k?t:Object(O.jsx)(a.a,{to:{pathname:"/login",state:{from:n}}})}}))}function S(e){return Object(O.jsxs)("div",{children:[Object(O.jsx)("h2",{children:"Login page"}),Object(O.jsx)("input",{placeholder:"login"}),Object(O.jsx)("input",{placeholder:"password"})]})}function y(e){return Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{style:{height:"60px",display:"flex",flexDirection:"row",boxShadow:"0px 2px 5px 0px rgb(0 0 0 / 50%)"},children:[Object(O.jsx)("span",{children:"1"}),Object(O.jsx)("span",{children:"2"})]}),Object(O.jsxs)("div",{style:{display:"flex"},children:[Object(O.jsx)("div",{style:{marginRight:"30px"},children:Object(O.jsx)("nav",{children:Object(O.jsxs)("ul",{children:[Object(O.jsx)("li",{children:Object(O.jsx)(s.b,{to:"/login",children:"Login"})}),Object(O.jsx)("li",{children:Object(O.jsx)(s.b,{to:"/",children:"Home"})}),Object(O.jsx)("li",{children:Object(O.jsx)(s.b,{to:"/about",children:"About"})}),Object(O.jsx)("li",{children:Object(O.jsx)(s.b,{to:"/users",children:"Users"})}),Object(O.jsx)("li",{children:Object(O.jsx)("a",{href:"/test",children:"Test"})})]})})}),Object(O.jsx)("div",{children:e.children})]})]})}function I(){return Object(O.jsx)(y,{children:Object(O.jsx)("h2",{children:"Home"})})}function E(){return Object(O.jsx)(y,{children:Object(O.jsx)("h2",{children:"About"})})}function C(){return Object(O.jsx)(y,{children:Object(O.jsx)("h2",{children:"Users"})})}var D=function(){return Object(O.jsx)(p,{children:Object(O.jsx)(s.a,{children:Object(O.jsxs)(a.d,{children:[Object(O.jsx)(w,{path:"/login",children:Object(O.jsx)(S,{})}),Object(O.jsx)(w,{path:"/about",children:Object(O.jsx)(E,{})}),Object(O.jsx)(w,{path:"/users",children:Object(O.jsx)(C,{})}),Object(O.jsx)(w,{path:"/",children:Object(O.jsx)(I,{})})]})})})},U=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,39)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),o(e),i(e)}))};i.a.render(Object(O.jsx)(c.a.StrictMode,{children:Object(O.jsx)(D,{})}),document.getElementById("root")),U()}},[[37,1,2]]]);
//# sourceMappingURL=main.dcc1947d.chunk.js.map